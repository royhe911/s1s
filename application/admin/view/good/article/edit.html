<style>
    #c-title ,#c-author,#c-type_id{
        width: 150px;
        height: 36px;
        border-radius: 4px;
        border: solid 1px #dddddd;
    }
    .btn-add {
        background-color: #34c191;
        border-radius: 4px;
    }
    .ac-img-url-box {
        margin-left: 15px;
    }
    .form-control {
        width: 310px;
        height: 90px;
        border-radius: 4px;
        border: solid 1px #dddddd;
        resize: none;
    }
    .btn-embossed {
        width: 100px;
        height: 36px;
        background-color: #34c191;
        border-radius: 4px;
        color: #fefefe;
    }
    .op {
        width: 150px;
        height: 36px;
        border-radius: 4px;
        border: solid 1px #dddddd;
    }
    /*校验字体样式*/
    span.error{
        /*border: 1px solid red;*/
        color: red;
        margin-top: 1.5px;
        height: 28px;
        font-size: 12px;
    }
</style>
<div class="panel-heading row" style="padding:0 15px;color: #999;font-size: 12px; line-height: 50px; background-color: transparent">
    <div style="background-color: #e8edf0;width: 100%; height: 50px;padding-left: 15px">
        <div class="lf">
            <i class="fa fa-home" style="font-size: 14px;"></i>
        </div>
        <div class="panel-lead lf" style="margin: 0px;">资讯管理&nbsp;&nbsp;&nbsp;> </div>
        <a href="/article/article" class="panel-lead lf pl" style="margin: 0px; color: #999 !important;">&nbsp;&nbsp;资讯列表&nbsp;&nbsp;&nbsp;> </a>
        <div class="panel-lead lf pl" style="margin: 0px;color: #34c191;">&nbsp;&nbsp;&nbsp;<?php echo isset($row) ? '添加资讯': '编辑资讯';?></div>
    </div>
</div>
<div class="panel-body" id='panel-body'>
    <form id="edit-form" class="form-horizontal" role="form" data-toggle="validator" method="POST">
        <input id="c-id" class="form-control" name="" type="hidden" value="{$row.id ?? ''}">
        <div class="form-group">
            <label for="c-title" class="control-label col-xs-12 col-sm-2"><span style="color: #ff777c;">*</span> 资讯名称:</label>
            <div class="col-xs-12 col-sm-8">
                <input id="c-title" name="c-title" class="form-control" type="text" value="{$row.title ?? ''}" style="display: inline-block;margin-right: 10px;">
            </div>
        </div>
        <div class="form-group">
            <label for="c-type_id" class="control-label col-xs-12 col-sm-2"><span style="color: #ff777c;">*</span> 资讯分类:</label>
            <div class="col-xs-12 col-sm-8">
                <select id="c-type_id" name="c-type_id" class="form-control" style="display: inline-block;margin-right: 10px;">
                    <option value="">请选择</option>
                    {volist name='type_list' id='vo'}
                    <option value="{$vo.id}" {if isset($row) && $row.type_id eq $vo.id}selected{/if}>{$vo.name}</option>
                    {/volist}
                </select>
            </div>
        </div>
        <div class="form-group">
            <label for="c-author" class="control-label col-xs-12 col-sm-2"><span style="color: #ff777c;">*</span> 资讯来源:</label>
            <div class="col-xs-12 col-sm-8">
                <input id="c-author" name="c-author" class="form-control" type="text" value="{$row.author ?? ''}" style="display: inline-block;margin-right: 10px;">
            </div>
        </div>
        <?php if($is_super_admin){ ?>
        <div class="form-group">
            <label for="c-name" class="control-label col-xs-12 col-sm-2"><span style="color: #ff777c;">*</span> 选择城市:</label>
            <!-- <input type="text" id="c-region_id" value="<?php echo empty($regions_data) ? '': (',' . implode(',', array_column($regions_data, 'id')) . ',');?>" style="display: inline-block;"> -->
            <div class="col-xs-12 col-sm-8">
                <select class="form-control op" id="c-is_visible" style="display: inline-block;margin-right: 10px;">
                    <option value="2">请选择</option>
                    <option <?php if(isset($row) && $row['is_visible']==1) echo 'selected';?> value="1">包含</option>
                    <option <?php if(isset($row) && $row['is_visible']==0) echo 'selected';?> value="0">不包含</option>
                </select>
                <div style="margin-top: 15px;">
                    <div id="add_city_show" style="display: inline-block;" >
                        <?php if(!empty($regions_data)) foreach($regions_data as $value){?>
                        <span style="display: inline-block;margin-right: 5px;padding: 6px 15px;border-radius: 4px;border: 1px solid #34c191;color: #34c191;vertical-align: middle">
                            <?php echo $value['name'] == '中国'? '全国': $value['name'];?>
                            <i class="iconfont icon-cha1 ac-delete" data-id="100000" data-index="0" style="color: #dddddd;margin-left: 10px;cursor: pointer;"></i>
                        </span>
                        <?php }?>
                    </div>
                    <a id="add_city" class="btn btn-success btn-add" style="padding: 8px 15px; margin-right: 10px;" data-database='<?php $regionsJson = empty($regions_data) ? "[]": json_encode($regions_data, JSON_UNESCAPED_UNICODE); echo $regionsJson?>'  href="javascript:;" onclick="layer_open('添加城市', '/article/article/region_list', {w:'750px',h:'820px'})" title="选择城市"><i class="fa fa-plus"></i> 选择城市</a>
                    <input id="c-region_id" name="c-region_id" type="hidden" value="<?php echo empty($regions_data) ? '': (',' . implode(',', array_column($regions_data, 'id')) . ',');?>" style="display: inline-block;">
                </div>
            </div>
        </div>
        <?php } ?>

        <div class="form-group">
            <label for="c-image" class="control-label col-xs-12 col-sm-2"><span style="color: #ff777c;">*</span> 资讯预览图:</label>
            <div class="l ac-img-container ac-img-url-box" data-name="image">
                {if isset($row.image_url) && $row.image_url != ''}
                <div class="formControls l mr-15 ta-imgItem ac-item-box">
                    <i class="os-radius"></i>
                    <img class="os-img" src="{$Think.config.qiniu.domain}{$row.image_url}" data-log="{$row.image_url}">
                </div>
                <div class="formControls l ta-imgItem ac-add hidden" style="width: 100px;height: 100px;">
                    <img class="os-pointer" src="__CDN__/assets/img/defaultAdd.png" id="img" data-picture="0">
                </div>
                {else}
                <div class="os-row">
                    <div class="formControls l ta-imgItem ac-add" style="width: 100px;height: 100px;">
                        <img class="os-pointer" src="__CDN__/assets/img/defaultAdd.png" id="img" data-picture="0">
                    </div>
                </div>
                {/if}
            </div>
        </div>
        <div class="form-group">
            <label for="c-name" class="control-label col-xs-12 col-sm-2"><span style="color: #ff777c;">*</span> 状态:</label>
            <div class="col-xs-12 col-sm-8" style="margin-left: 20px;margin-top: -5px;"> 
                <div class="radio">
                    <label for="" class="radio-inline"><input {if isset($row) && $row.is_show eq 1}checked="checked"{/if} name="c-is_show" type="radio" value="1">正常</label>
                    <label for="" class="radio-inline"><input {if isset($row) && $row.is_show eq 0}checked="checked"{/if} name="c-is_show" type="radio" value="0">隐藏</label>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label for="c-desc" class="control-label col-xs-12 col-sm-2"><span style="color: #ff777c;">*</span> 资讯简介:</label>
            <div class="col-xs-12 col-sm-8">
                <textarea id="c-desc" name="c-desc" class="form-control" style="width: 310px;height: 90px;display: inline-block;margin-right: 10px;vertical-align: top;"><?php if(isset($row['desc'])) echo htmlspecialchars_decode($row['desc']);?></textarea>
            </div>
        </div>
        <div class="form-group">
            <label for="c-description" class="control-label col-xs-12 col-sm-2"><span style="color: #ff777c;">*</span> 资讯内容:</label>
            <div class="col-xs-12 col-sm-8">
                <script id="editor" type="text/plain"><?php if(isset($row['content'])) echo htmlspecialchars_decode($row['content']);?></script>
            </div>
        </div>
        <div class="form-group">
            <label for="c-position" class="control-label col-xs-12 col-sm-2"><span style="color: #ff777c;">*</span> 显示端:</label>
            <div class="col-xs-12 col-sm-8">
                <select id="c-position" name="c-position" class="form-control op" style="display: inline-block;margin-right: 10px;">
                	<option {if isset($row) && $row.position == 0}selected{/if} value="0">全部</option>
                    <option {if isset($row) && $row.position == 1}selected{/if} value="1">用户端</option>
                    <option {if isset($row) && $row.position == 2}selected{/if} value="2">商家端</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-xs-12 col-sm-2"></label>
            <div class="col-xs-12 col-sm-8">
                <input id="submit" type="submit" class="btn btn-success btn-embossed" value="保 存"></input>
                <!-- <button type="reset" class="btn btn-default btn-embossed">{:__('Reset')}</button> -->
            </div>
        </div>
    </form>
</div>
<script>window.UEDITOR_HOME_URL = '__CDN__/assets/libs/ueditor/1.4.3/'</script>
<script type="text/javascript" charset="utf-8" src="__CDN__/assets/libs/ueditor/1.4.3/ueditor.config.js?v={$site.version}"></script>
<script type="text/javascript" charset="utf-8" src="__CDN__/assets/libs/ueditor/1.4.3/ueditor.all.js?v={$site.version}"> </script>
<script type="text/javascript" charset="utf-8" src="__CDN__/assets/libs/ueditor/1.4.3/lang/zh-cn/zh-cn.js?v={$site.version}"></script>
<!-- <script type="text/javascript" charset="utf-8" src="__CDN__/assets/js/backend/error_msg.js?v={$site.version}"></script> -->
<!-- 表单校验插件 -->
<script type="text/javascript" charset="utf-8" src="__CDN__/assets/js/backend/jquery-validation-1.14.0/jquery.validate.js?v={$site.version}"></script>
<script type="text/javascript" charset="utf-8" src="__CDN__/assets/js/backend/jquery-validation-1.14.0/additional-methods.js"></script>
<script type="text/javascript" src="__CDN__/assets/js/backend/validate/article/article/article.js"></script>

<script>
    up_img_System("img");
    $("#edit-form").on("click", ".ac-item-box i", function () {
        var os = $(this).parent();
        var add = os.nextAll(".ac-add");
        os.remove();
        var isMain = $("#edit-form .ac-item");
        if (os.children("sup").length != 0 && isMain.length > 0) {
            $(isMain[0]).prepend("<sup></sup>");
        }
        console.log(add.length);
        if (add.hasClass("hidden")) {
            add.removeClass("hidden");
        }
    });

    $("#add_city_show").on("click", ".ac-delete", function () {
        var edit_brand = $("#add_city");
        var array = JSON.parse(edit_brand.attr("data-database"));
        var attr_index = $(this).attr("data-index");
        array.splice(attr_index, 1);
        var str_array = JSON.stringify(array)
        edit_brand.attr("data-database", str_array);
        $("#c-region_id").val(JSON.stringify(str_array));
        $(this).parent().remove();
    });

    $(function () {
        var ue = UE.getEditor('editor', {
            serverUrl:'/ueditor/index?prefix=2',
            toolbars: [
                [],
                ['fullscreen', 'source', 'undo', 'redo', 'bold', 'indent', 'italic', 'underline', 'pasteplain', 'selectall', 'time', 'date', 'inserttable', 'fontfamily', 'fontsize'],
                ['insertimage', 'simpleupload', 'link', 'spechars', 'justifyleft', 'justifyright', 'justifycenter', 'justifyjustify', 'forecolor', 'backcolor', 'autotypeset', 'touppercase', 'tolowercase' ]
            ],
            videoUrlPrefix: '',
            inputXssFilter: false,
            initialFrameWidth:"500",
            initialFrameHeight:"300"
        });
    });
</script>
