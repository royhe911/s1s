<style>
    .op {
        width: 170px !important;
    }
    /*校验字体样式*/
    span.error{
        /*border: 1px solid red;*/
        color: red;
        margin-top: 1.5px;
        height: 28px;
        font-size: 12px;
    }
    #panel-body label{
    	width:100px!important;
    }
    
    .bg_box{
    	width:100%;
    	height:100%;
    	position:fixed;
    	left:0;
    	top:0;
    	background:rgba(0,0,0,0.2);
    	display: none;
    	z-index:9999999;
    }
    .bg_box .big_img img{
    	width:80vw;
    	max-height:95vh;
    	position:absolute;
    	left:0;
    	right:0;
    	top:0;
    	bottom:0;
    	margin:auto;
    }
</style>
<div class="panel-heading row" style="padding:0 15px;color: #999;font-size: 12px; line-height: 50px; background-color: transparent">
    <div style="background-color: #e8edf0;width: 100%; height: 50px;padding-left: 15px">
        <div class="lf">
            <i class="fa fa-home" style="font-size: 14px;"></i>
        </div>
        <div class="panel-lead lf" style="margin: 0px;">商品管理&nbsp;&nbsp;&nbsp;> </div>
        <a href="<?php echo url('good/index');?>" class="panel-lead lf pl" style="margin: 0px; color: #999 !important;">&nbsp;&nbsp;商品列表&nbsp;&nbsp;&nbsp;> </a>
        <div class="panel-lead lf pl" style="margin: 0px;color: #34c191;">&nbsp;&nbsp;&nbsp;
            <?php echo empty($row) ? '添加商品': '编辑商品';?>
        </div>
    </div>
</div>
<div class="panel-body" id='panel-body'>
    <form id="edit-form" class="form-horizontal" role="form" data-toggle="validator" method="POST" action="">

        <input id="c-id" data-rule="required" class="form-control" name="" type="hidden" value="{$row.id ?? ''}">
        <div class="form-group shop_box">
            <label for="c-shop_id" class="control-label col-xs-12 col-sm-2"><span style="color: #ff777c;">*</span> 选择门店:</label>
            <div class="col-xs-12 col-sm-8">
                <!--存在开始-->
                {if isset($row.shop_id) && $row.shop_id neq ''}
                <a id="add_shop_id" href="javascript:;" onclick="layer_open('选择门店', '/good/shop_list',{w:'1000px',y:'900px'})" class="btn btn-success btn-add hidden mr-10" title="选择门店"><i class="fa fa-plus"></i> 选择门店</a>
                <div style="position: relative;padding: 7px 15px;display: inline-block;background: #fff;border: 1px solid #dddddd;">
                    <img onclick="del_store_val(this)" src="/assets/img/close_red.png" style="width: 13px;height: 13px;position: absolute;top: -5px;right: -5px;cursor:pointer">{$row.name ?? ''}
                </div>
                <input id="c-shop_id" name="c-shop_id" class="op" type="hidden" value="{$row.shop_id}">
                {else}
                <!--存在结束-->
                <a id="add_shop_id" href="javascript:;" onclick="layer_open('选择门店', '/good/shop_list',{w:'1000px',y:'900px'})" class="btn btn-success btn-add mr-10" title="选择门店" style="height: 36px;line-height: 23px;"><i class="fa fa-plus"></i> 选择门店</a>
                <input id="c-shop_id" name="c-shop_id" class="op" type="hidden" value="">
                {/if}
            </div>
        </div>
        <div class="form-group">
            <label for="c-brand_id" class="control-label col-xs-12 col-sm-2"> 选择品牌:</label>
            <div class="col-xs-12 col-sm-8">
                <select id="c-brand_id" name="c-brand_id" class="form-control op" style="display: inline-block;width: 300px;margin-right: 10px;">
                    <option value="">请选择品牌</option>
                    <?php if (!empty($brand_list)) foreach($brand_list as $key => $value){?>
                    <option value="{$value}" <?php if(isset($row['brand']) && $row['brand']==$value) echo 'selected';?>>{$value}</option>
                    <?php }?>
                </select>
            </div>
        </div>
        
        <!--新增商品平台类-->
        <div class="form-group">
            <label for="c-product_id" class="control-label col-xs-12 col-sm-2"><span style="color: #ff777c;">*</span> 商品平台分类:</label>
            <div class="col-xs-12 col-sm-8">
                <select id="c-product_id" name="c-product_id" class="form-control op" style="display: inline-block;margin-right: 10px;">
                    <option value="">请选择商品平台分类</option>
                    {$pt_good_type|raw}
                </select>
            </div>
        </div>
        
        <div class="form-group">
            <label for="c-type_id" class="control-label col-xs-12 col-sm-2"><span style="color: #ff777c;">*</span> 商品分类:</label>
            <div class="col-xs-12 col-sm-8">
                <select id="c-type_id" name="c-type_id" class="form-control op" style="display: inline-block;margin-right: 10px;">
                    <option value="">请选择商品分类</option>
                    {notempty name='good_type'}
                    {$good_type|raw}
                    {/notempty}
                </select>
            </div>
        </div>
        <div class="form-group">
            <label for="c-title" class="control-label col-xs-12 col-sm-2"><span style="color: #ff777c;">*</span> 商品名称:</label>
            <div class="col-xs-12 col-sm-8">
                <input id="c-title" name="c-title" class="form-control op" type="text" value="{$row.title ?? ''}" style="display: inline-block;margin-right: 10px;">
            </div>
        </div>
        <div class="form-group row">
            <label for="c-img" class="control-label col-xs-12 col-sm-2"><span style="color: #ff777c;line-height: 100px;">*</span> 商品预览图:</label>
            <div class="col-xs-12 col-sm-10">
                <div class="l ac-img-container" id="imgList">
                    <div class="os-row">
                        {if isset($row.good_images) && $row.good_images neq ''}
                        {volist name='row.good_images' id='vo' length='5'}

                        {if $i eq 1}
                        <div class="formControls l mr-15 ta-imgItem ac-item-box" style="margin-bottom: 10px;">
                            <sup></sup>
                            <i class="os-radius"></i>
                            <img class="os-img" src="{$Think.config.qiniu.domain}{$vo.goods_image}" data-log="{$vo.goods_image}">
                        </div>
                        {else}
                        <div class="formControls l mr-15 ta-imgItem ac-item-box" style="margin-bottom: 10px;">
                            <i class="os-radius"></i>
                            <img class="os-img" src="{$Think.config.qiniu.domain}{$vo.goods_image}" data-log="{$vo.goods_image}">
                        </div>
                        {/if}

                        {/volist}
                        {if count($row.good_images) lt 5}
                        <div class="formControls l ta-imgItem ac-add" style="width: 100px;height: 100px;">
                            <img class="os-pointer" src="__CDN__/assets/img/defaultAdd1.png" id="img">
                        </div>
                        {else}
                        <div class="formControls l ta-imgItem ac-add hidden" style="width: 100px;height: 100px;">
                            <img class="os-pointer" src="__CDN__/assets/img/defaultAdd1.png" id="img">
                        </div>
                        {/if}
                        {else}
                        <div class="formControls l ta-imgItem ac-add" style="width: 100px;height: 100px;">
                            <img class="os-pointer" src="__CDN__/assets/img/defaultAdd1.png" id="img">
                        </div>
                        {/if}
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label for="c-price" class="control-label col-xs-12 col-sm-2">商品价格:</label>
            <div class="col-xs-12 col-sm-8">
                <input id="c-price" name="c-price" class="form-control op" type="text" value="{$row.price ?? ''}" style="display: inline-block;width: 300px;margin-right: 10px; width: 150px;" >
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-xs-12 col-sm-2"><span style="color: #ff777c;">*</span> 商品详情:</label>
            <div class="col-xs-12 col-sm-8">
                <script id="editor" type="text/plain"><?php echo !isset($html) ? '': htmlspecialchars_decode($html);?></script>
            </div>
        </div>
        <div class="form-group">
            <label for="submit" class="control-label col-xs-12 col-sm-2"></label>
            <div class="col-xs-12 col-sm-8">
                <input id="submit" name="submit" type="submit" value="保 存" class="btn btn-success btn-embossed"></input>
            </div>
        </div>
    </form>
</div>

<div class="bg_box">
	<div class="big_img">
		<img src="http://p6afqc9lx.bkt.clouddn.com/upload/image/1526627488113.image"/>
	</div>
</div>

<script>window.UEDITOR_HOME_URL = '__CDN__/assets/libs/ueditor/1.4.3/'</script>
<script type="text/javascript" charset="utf-8" src="__CDN__/assets/libs/ueditor/1.4.3/ueditor.config.js?v={$site.version}"></script>
<script type="text/javascript" charset="utf-8" src="__CDN__/assets/libs/ueditor/1.4.3/ueditor.all.js?v={$site.version}"> </script>
<script type="text/javascript" charset="utf-8" src="__CDN__/assets/libs/ueditor/1.4.3/lang/zh-cn/zh-cn.js?v={$site.version}"></script>
<!-- 表单校验插件 -->
<script type="text/javascript" charset="utf-8" src="__CDN__/assets/js/backend/jquery-validation-1.14.0/jquery.validate.js?v={$site.version}"></script>
<script type="text/javascript" charset="utf-8" src="__CDN__/assets/js/backend/jquery-validation-1.14.0/additional-methods.js"></script>
<script type="text/javascript" src="__CDN__/assets/js/backend/validate/good/edit.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script>
    function del_store_val(os_this) {
        var this_parent = $(os_this).parent();
        this_parent.prev().removeClass("hidden");
        this_parent.next().val("");
        console.log(this_parent.next());
        console.log(this_parent.next().val());

        this_parent.remove();
        // var brand_item = $("#c-brand_id");
        // brand_item.html('<option value="0">请先选择门店</option>');
        // var type_item = $("#c-type_id");
        // type_item.html('<option value="0">请选择商品分类</option>');
    }
    // 商品详情项的图片上传框
    $(function () {
        var ue = UE.getEditor('editor', {
            serverUrl: '/ueditor/index?prefix=1',
            toolbars: [
              [],
              ['fullscreen', 'source', 'undo', 'redo', 'bold', 'indent', 'italic', 'underline', 'pasteplain', 'selectall', 'time', 'date', 'inserttable', 'fontfamily', 'fontsize'],
              ['insertimage', 'simpleupload', 'link', 'spechars', 'justifyleft', 'justifyright', 'justifycenter', 'justifyjustify', 'forecolor', 'backcolor', 'autotypeset', 'touppercase', 'tolowercase']
            ],
            videoUrlPrefix: '',
            inputXssFilter: false,
            initialFrameWidth:"500",
            initialFrameHeight:"300"
        });
        
        //	图片放大预览
	    $(document).on('click','.os-img',function(){
	    	var img_url=$(this).attr('src');
	    	$('.bg_box img').attr('src',img_url);
	    	$('.bg_box').show();   	
	    	$('.bg_box').click(function(){
				$('.bg_box').hide();
			})
	    })
        
    });
    // 图片上传
    up_img_System("img");
    // 图片删除方法
    $("#edit-form").on("click", ".ac-item-box i", function () {
        var os = $(this).parent();
        var add = os.nextAll(".ac-add");
        os.remove();
        var isMain = $("#edit-form .ac-item-box");
        if (os.children("sup").length != 0 && isMain.length > 0) {
            $(isMain[0]).prepend("<sup></sup>");
        }
        console.log(add.length);
        if (add.hasClass("hidden")) {
            add.removeClass("hidden");
        }
    });
    
//  图片拖拽
    $( "#imgList .os-row" ).sortable({
		containment: 'parent',
		cancel: '.ac-add',
		items: '.ac-item-box',
		stop:function(event,ui){    			
			$('#imgList .ac-item-box sup').remove();
			var list=$('#imgList .ac-item-box');
			var sup=$('<sup></sup>');
			list.eq(0).append(sup);
		}
	});
</script>
