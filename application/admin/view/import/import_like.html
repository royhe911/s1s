<script src="https://cdn.bootcss.com/vue/2.5.16/vue.min.js"></script>
<style type="text/css">
	table tbody tr.active td{
		background:#D3DDC8!important;
	}
</style>
<div class="panel panel-default panel-intro">
    <div class="panel-heading row" style="padding-top:0;color: #999;font-size: 12px; line-height: 50px; background-color: transparent">
        <div style="background-color: #e8edf0;width: 100%; height: 50px;padding-left: 15px">
            <div class="lf">
                <i class="fa fa-home" style="font-size: 14px;"></i>
            </div>
            <div class="panel-lead lf" style="margin: 0px;">导入管理&nbsp;&nbsp;&nbsp;> </div>
            <a href="<?php echo url('import/index');?>" class="panel-lead lf pl" style="margin: 0px; color: #999 !important;">&nbsp;&nbsp;导入列表&nbsp;&nbsp;&nbsp;> </a>
            <div class="panel-lead lf pl" style="margin: 0px;color: #34c191;">&nbsp;&nbsp;&nbsp;相似列表
            </div>
        </div>
    </div>
    <div class="panel-body">
        <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade active in" id="one">
                <div class="widget-body no-padding">
                    <div class="bootstrap-table">
                        <div class="fixed-table-toolbar">
                            <div class="row" style="margin:0;">
                                <div class="bs-bars pull-left" style="width: 100%;margin-bottom: 0">
                                    <div id="toolbar" class="toolbar" style="position: relative;">
                                        <a href="javascript:;" onclick="import_data(0);" class="ac-is-stop btn btn-success bs-bars-com btn-status-enable btn-disabled disabled"
                                           title="导入" style="background-color: #37c6c0;"> 批量导入</a>                                       
                                    </div>                                    
                                </div>
                            </div>
                        </div>
                        <div class="fixed-table-container" style="padding-bottom: 0px;margin-top: 15px;">
                            <div class="fixed-table-header" style="display: none;">
                                <table></table>
                            </div>
                            <div class="fixed-table-body">

                                <table id="table" class="table table-striped table-bordered table-hover" data-operate-edit="1" data-operate-del="1" width="100%">
                                    <thead>
                                        <tr style="background-color: #e8f7f2;">
                                            <th class="bs-checkbox " style="text-align: center; vertical-align: middle; width: 36px; " data-field="0">
                                                <div class="th-inner ">
                                                    <input name="btSelectAll" id="btSelectAll" type="checkbox">
                                                </div>
                                                <div class="fht-cell"></div>
                                            </th>
                                            <th style="text-align: center; vertical-align: middle; " data-field="">
                                                <div class="th-inner ">编号</div>
                                                <div class="fht-cell"></div>
                                            </th>
                                            <th style="text-align: center; vertical-align: middle; " data-field="">
                                                <div class="th-inner ">门店名称</div>
                                                <div class="fht-cell"></div>
                                            </th>
                                            <th style="text-align: center; vertical-align: middle; " data-field="">
                                                <div class="th-inner ">门店分类</div>
                                                <div class="fht-cell"></div>
                                            </th>
                                            <th style="text-align: center; vertical-align: middle; " data-field="">
                                                <div class="th-inner ">区</div>
                                                <div class="fht-cell"></div>
                                            </th>
                                            <th style="text-align: center; vertical-align: middle; " data-field="">
                                                <div class="th-inner ">商圈</div>
                                                <div class="fht-cell"></div>
                                            </th>
                                            <th style="text-align: center; vertical-align: middle; " data-field="">
                                                <div class="th-inner ">门店地址</div>
                                                <div class="fht-cell"></div>
                                            </th>
                                            <th style="text-align: center; vertical-align: middle; " data-field="">
                                                <div class="th-inner ">来源</div>
                                                <div class="fht-cell"></div>
                                            </th>
                                            <th style="text-align: center; vertical-align: middle; " data-field="">
                                                <div class="th-inner ">启用状态</div>
                                                <div class="fht-cell"></div>
                                            </th>
                                            <th style="text-align: center; vertical-align: middle; " data-field="">
                                                <div class="th-inner ">认领状态</div>
                                                <div class="fht-cell"></div>
                                            </th>
                                            <th style="text-align: center; vertical-align: middle; " data-field="">
                                                <div class="th-inner ">操作</div>
                                                <div class="fht-cell"></div>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody data-listidx="0">
                                        {volist name='list' id='vo'}
                                        <tr>
                                            <td class="bs-checkbox ">
                                                <input data-index="{$i-1}" value="{$vo.id}" name="btSelectItem" type="checkbox">
                                            </td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo.id}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo.shop_name}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo.type_name}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo.region_id_3}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo.region_id_4}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo.address}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo.data_source}</td>
                                            <td style="text-align: center; vertical-align: middle; ">---</td>
                                            <td style="text-align: center; vertical-align: middle; ">---</td>
                                            <td style="text-align: center; vertical-align: middle; ">
                                                {if $vo.is_import == 1}
                                                已导入
                                                {elseif $vo.is_import == 2}
                                                已删除
                                                {else}
                                                
                                                <a href="javascript:;" onclick="del({$vo.id}, 1,this);" class="albumCC btn-delone" title="删除" data-table-id="table" data-field-index="9"
                                                   data-row-index="30" data-button-index="2">
                                                    <i class="iconfont icon-shanchu"></i>
                                                </a>
                                                <a href="javascript:;" onclick="import_data({$vo.id});" class="albumCC btn-delone" title="导入" data-table-id="table" data-field-index="9"
                                                   data-row-index="30" data-button-index="2">
                                                    <i class="iconfont icon-tianjia1"></i>
                                                </a>
                                                {/if}
                                            </td>
                                        </tr>
                                        {notempty name='$vo.child'}
                                        {volist name='$vo.child' id='vo2'}
                                        <tr>
                                            <td class="bs-checkbox ">

                                            </td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo.id}</td>
                                            {empty name='$vo2.name'}
                                            <td style="text-align: center; vertical-align: middle; ">{$vo2.shop_name}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo2.type_name}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo2.region_id_3}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo2.region_id_4}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo2.address}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo2.data_source}</td>
                                            <td style="text-align: center; vertical-align: middle; ">---</td>
                                            <td style="text-align: center; vertical-align: middle; ">---</td>
                                            <td style="text-align: center; vertical-align: middle; ">
                                                {if $vo.is_import eq 1 || $vo.is_import eq 2}
                                                ---
                                                {else}
                                                {if $vo2.is_import eq 3}
                                                已排除
                                                {else}
                                                已删除
                                                {/if}

                                                {/if}
                                            </td>
                                            {else}
                                            <td style="text-align: center; vertical-align: middle; ">{$vo2.name}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo2.s_type_name}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{if isset($region_list_3[$vo2.s_region_id_3])}{$region_list_3[$vo2.s_region_id_3]}{/if}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{if isset($region_list_4[$vo2.s_region_id_4])}{$region_list_4[$vo2.s_region_id_4]}{/if}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo2.s_address}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo2.s_data_source == 1 ? '抓取' : ($vo2.s_data_source == 2 ? '导入' : '后台添加')}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo2.status == 1 ? '启用' : '停用'}</td>
                                            <td style="text-align: center; vertical-align: middle; ">{$vo2.is_user_status == 1 ? '已认领' : ($vo2.is_user_status == 2 ? '认领中' : '未认领')}</td>
                                            <td style="text-align: center; vertical-align: middle; ">
                                                {if $vo2.is_user_status eq 1 || $vo.is_import eq 1 || $vo.is_import eq 2 || $vo2.is_import eq 3}
                                                {if $vo2.is_import eq 3}
                                                已排除
                                                {else}
                                                ---
                                                {/if}
                                                {else}
                                                <a href="javascript:;" onclick="del({$vo2.id}, 2,this);" class="albumCC btn-delone" title="删除" data-table-id="table" data-field-index="9"
                                                   data-row-index="30" data-button-index="2">
                                                    <i class="iconfont icon-shanchu"></i>
                                                </a>
                                                <a href="javascript:;" onclick="del({$vo2.id}, 3,this);" class="albumCC btn-delone" title="排除" data-table-id="table" data-field-index="9"
                                                   data-row-index="30" data-button-index="2">
                                                    <img style="width:18px;margin-top:-5px;" src="/assets/img/exclude.png" alt="排除" />
                                                </a>
                                                {/if}
                                            </td>
                                            {/empty}
                                        </tr>
                                        {/volist}
                                        {/notempty}
                                        {/volist}
                                    </tbody>
                                </table>
                            </div>
                            <div class="fixed-table-footer" style="display: none;">
                                <table>
                                    <tbody>
                                        <tr></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
	$(function(){
		$('.num_list').change(function(){
	    	var value=$(this).find('option:selected').val();	    	
	    	location.href = '/import/import_like?branch_no='+{$branch_no}+'&cur_limit=' + value;
	    })
		
		$('table tbody tr').hover(function(){
			$(this).addClass('active').siblings().removeClass('active');
		})
	})
    function import_data(ids) {
        if (ids == 0) {
            ids = get_select_all();
        }
        if (ids == '') {
            alert('请选择要操作的数据');
            return false;
        }
        $.post('/import/import_data', { ids: ids }, function (data) {
            if (data.code == 1) {
                layer.msg(data.msg, {
                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                }, function () {
                    window.location.reload();
                });
            } else {
                layer.msg(data.msg);
            }
        }, 'json')
    }

    function del(ids, sign,e) {
    	var o_parent=e.parentNode;
    	
        if (ids == '') {
            layer.msg('请选择要操作的数据');
            return false;
        }
        $.post('/import/delete_like', { ids: ids, sign: sign }, function (data) {
            if (data.code == 1) {
                layer.msg(data.msg, {
                    time: 1000 //2秒关闭（如果不配置，默认是3秒）
                }, function () {
					o_parent.innerHTML='已删除'
                });
            } else {
                layer.msg(data.msg);
            }
        }, 'json')
   }   
</script>