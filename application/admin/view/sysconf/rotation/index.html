<div class="panel panel-default panel-intro">
    <div class="panel-heading row" style="padding-top:0;color: #999;font-size: 12px; line-height: 50px; background-color: transparent">
        <!-- <div class="panel-lead"><em>门店分类管理</em></div> -->
        <div style="background-color: #e8edf0;width: 100%; height: 50px;padding-left: 15px">
            <div class="lf">
                <i class="fa fa-home" style="font-size: 14px;"></i>
            </div>
            <div class="panel-lead lf" style="margin: 0px;">系统配置&nbsp;&nbsp;&nbsp;> </div>
            <div class="panel-lead lf pl" style="margin: 0px;color: #34c191;">&nbsp;&nbsp;&nbsp;轮播图管理</div>
        </div>
    </div>
    <div class="panel-body">
        <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade active in" id="one">
                <div class="widget-body no-padding">
                    <div class="bootstrap-table">
                        <div class="fixed-table-toolbar clearfix">
                            <form id="edit-form" class="form-horizontal pull-left" role="form" data-toggle="validator" method="get" action="">
                                <div class="row"  style="margin:0;">
                                    {if $is_super_admin}
                                    <div style="float: left;width: 150;margin-right: 5px;">
                                        <select class="form-control title-input"  name="region_id_1" id="region_id_1" onchange='javascript:get_type("city_id", this.value, 0)'>
                                            <option value="">省</option>
                                            {volist name='region_list_1' id='vo'}
                                            <option value="{$key}" {if $Request.get.region_id_1 eq $key}selected{/if}>{$vo}</option>
                                            {/volist}
                                        </select>
                                    </div>
                                    <div style="float: left;width: 150;margin-right: 5px;">
                                        <select class="form-control title-input"  name="city_id" id="city_id">
                                            <option value="">市</option>
                                        </select>
                                    </div>
                                    {/if}
                                    <div style="float: left;width: 150;margin-right: 5px;">
                                        <select class="form-control title-input"  name="is_show" id="is_show">
                                            <option value="-1" {if $is_show eq -1 || $is_show eq ''}selected{/if}>状态</option>
                                            <option value="1" {if $is_show eq 1}selected{/if}>显示</option>
                                            <option value="0" {if $is_show eq 0}selected{/if}>隐藏</option>
                                        </select>
                                    </div>
                                    <div style="float: left;width: 150;margin-right: 5px;">
                                        <select class="form-control title-input" name="device" id="device">
                                            <option value="">位置</option>
                                            <option value="1" {if $Request.get.device eq 1}selected{/if}>Android</option>
                                            <option value="2" {if $Request.get.device eq 2}selected{/if}>IOS</option>
                                            <option value="3" {if $Request.get.device eq 3}selected{/if}>小程序</option>
                                            <option value="4" {if $Request.get.device eq 4}selected{/if}>PC</option>
                                        </select>
                                    </div>
                                    <div style="float: left;width: 100px;">
                                        <button id="submit" class="btn btn-success btn-ok btn-embossed" style="width: 100%;height: 36px;background-color: #34c191">搜索</button>
                                    </div>
                                </div>
                            </form>
                            <div class="row" style="margin:0;">
                            	<div class="num pull-right" style="margin-left:10px;">
	                            	<select class="pull-left form-control title-input num_list" style="width:110px;border-color:#34C191;">
	                                	<option value="0">查看条数</option>
	                                	{volist name='page_list' id='vo'}
	                                	<option value="{$vo}" {if $Think.session.cur_limit eq $vo}selected{/if}>{$vo}</option>
	                                	{/volist}
	                                </select>
	                            </div>   
                                <div class="bs-bars pull-right" style="margin:0;">
                                    <div id="toolbar" class="toolbar" style="position: relative; background-color: #37c6c0;">
                                        <a href="/sysconf/rotation/add"  class="btn btn-success btn-add bs-bars-com" title="添加"> 添加轮播</a>
                                    </div>
                                </div>                               
                            </div>
                        </div>
                        <p style="float: right;font-size: 12px;padding: 8px; margin: 0">共计
                            <span style="color: #34c191;">{$list->total()}</span> 个轮播图</p>
                        <div class="fixed-table-container" style="padding-bottom: 0px;margin-top: 15px;">
                            <div class="fixed-table-header" style="display: none;">
                                <table></table>
                            </div>
                            <div class="fixed-table-body">

                                <table id="table" class="table table-striped table-bordered table-hover" data-operate-edit="1" data-operate-del="1" width="100%">
                                    <thead>
                                    <tr style="background-color: #e8f7f2">
                                        <th style="text-align: center; vertical-align: middle; " data-field="">
                                            <div class="th-inner ">Id</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th style="text-align: center; vertical-align: middle; " data-field="">
                                            <div class="th-inner ">轮播图片</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th style="text-align: center; vertical-align: middle; " data-field="">
                                            <div class="th-inner ">轮播名称</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th style="text-align: center; vertical-align: middle; " data-field="">
                                            <div class="th-inner ">排序</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        {if $is_super_admin}
                                        <th style="text-align: center; vertical-align: middle; " data-field="">
                                            <div class="th-inner ">是否包含</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th style="text-align: center; vertical-align: middle; " data-field="">
                                            <div class="th-inner ">城市</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        {/if}
                                        <th style="text-align: center; vertical-align: middle; " data-field="">
                                            <div class="th-inner ">位置</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th style="text-align: center; vertical-align: middle; " data-field="">
                                            <div class="th-inner ">状态</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th style="text-align: center; vertical-align: middle; " data-field="">
                                            <div class="th-inner ">操作</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody data-listidx="0">
                                    {volist name='list' id='vo'}
                                    <tr class="ac-tr">
                                        <td style="text-align: center; vertical-align: middle; ">{$vo.id}</td>
                                        <td style="text-align: center; vertical-align: middle; ">
                                            <img style="max-height: 60px;" src="{$Think.config.qiniu.domain}/{$vo.image_xcx}">
                                        </td>
                                        <td style="text-align: center; vertical-align: middle; ">{$vo.title}</td>
                                        <td style="text-align: center; vertical-align: middle; ">
                                            <input type="text" class="input-text table-input ac-input-number ac-sort" data-id="{$vo.id}" maxlength="3" id="{$vo.id}" data-val="{$vo.sort ?? 0}"  value="{$vo.sort ?? 0}" style="border:1px solid #ddd">
                                        </td>
                                        {if $is_super_admin}
                                        <td style="text-align: center; vertical-align: middle; ">{if $vo.is_visible eq 1}是{else}否{/if}</td>
                                        <td style="text-align: center; vertical-align: middle; width: 500px;">{$vo.city_str ?? ''}</td>
                                        {/if}
                                        <td style="text-align: center; vertical-align: middle; ">
                                            {in name="1" value="$vo.device"}
                                            Android
                                            {/in}
                                            {in name="2" value="$vo.device"}
                                            Ios
                                            {/in}
                                            {in name="3" value="$vo.device"}
                                            小程序
                                            {/in}
                                            {in name="4" value="$vo.device"}
                                            Pc
                                            {/in}
                                        </td>
                                        <td style="text-align: center; vertical-align: middle; ">
                                            {if $vo.is_show eq 1}
                                            <a class="btn-change text-success ac-is-stop" href="javascript:;" data-isStop="0" data-id="{$vo.id}" title="隐藏">
                                                <i class="fa fa-toggle-on fa-2x" style="color: #18bc9c;"></i>
                                            </a>
                                            {else}
                                            <a class="btn-change text-success ac-is-stop" href="javascript:;" data-isStop="1" data-id="{$vo.id}" title="显示">
                                                <i class="fa fa-toggle-off fa-2x" style="color: #18bc9c;"></i>
                                            </a>
                                            {/if}
                                        </td>
                                        <td style="text-align: center; vertical-align: middle; ">
                                            <!-- <a href="/sysconf/rotation/edit/ids/{$vo.id}" class="albumCC btn-editone" title="编辑" data-table-id="table" data-field-index="9" data-row-index="0" data-button-index="0"><i class="iconfont icon-edit"></i></a> -->
                                            <a href="javascript:;" data-url="/sysconf/rotation/edit/ids/{$vo.id}" class="<?php echo ($vo['is_show'] == 1) ? 'editClick': 'btn-s';?> btn-editone btn-color editCC"
                                                title="编辑" data-table-id="table" data-field-index="9" data-row-index="0" data-button-index="0" style="margin-right: 5px;">
                                                <i class="iconfont icon-edit"></i>
                                            </a>
                                            <a href="javascript:;" onclick="del({$vo.id});" class="albumCC btn-delone" title="删除" data-table-id="table" data-field-index="9" data-row-index="30" data-button-index="2"><i class="iconfont icon-shanchu"></i></a>
                                        </td>
                                    </tr>
                                    {/volist}
                                    </tbody>
                                </table>
                            </div>
                            <div class="fixed-table-footer" style="display: none;">
                                <table>
                                    <tbody>
                                    <tr></tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="fixed-table-pagination">{$list->render()|raw}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    (function () {
    	//切换显示条数
		$('.num_list').change(function(){
        	var value=$(this).find('option:selected').val(); 
        	var region_id_1=$('select[name="region_id_1"]').find('option:selected').val();
        	var city_id=$('select[name="city_id"]').find('option:selected').val();
        	var is_show=$('select[name="is_show"]').find('option:selected').val();
        	var device=$('select[name="device"]').find('option:selected').val();
        	location.href = '/sysconf/rotation/index?cur_limit=' + value+'&region_id_1='+region_id_1+'&city_id='+city_id+'&is_show='+is_show+'&device='+device;        	    
        })
    	
        $(".ac-input-number").on("input", function () {
            fun.inputNumber($(this));
        });

        var obj = {};
        obj.url = "/sysconf/rotation/edit_sort";
        sort_edit(obj);
        var prevent_more_click = true;
        $(".ac-is-stop").on("click", function () {
            if(prevent_more_click) {
                var obj = {
                    url: '/sysconf/rotation/edit_status',
                    info_msg: '请选择要操作的轮播图',
                    show_stop:"隐藏",
                    show_start:"显示"
                };
                obj.os_this = $(this);
                obj.is_stop = $(this).attr("data-isStop");
                obj.id = $(this).attr("data-id");
                is_stop(obj);
                prevent_more_click = false;
                setTimeout(function () {
                    prevent_more_click = true;
                }, 600);
            }
             if (obj.is_stop == 1) {
                $(this).parent().next().children('.btn-editone').removeClass('btn-s').addClass('editClick')
            } else {
                $(this).parent().next().children('.btn-editone').removeClass('editClick').addClass('btn-s')
                // $('this').css('backgroundColor', '#34c191')
            }
        });
         $(document).on('click', '.btn-s', function () {
            var url = $(this).attr('data-url');
            window.location.href = url;
        })

         //提交
        $('#submit').on('click', function () {
            var is_show = $('#is_show').val() || '';
            var region_id_1 = $('#region_id_1').val() || '';
            var city_id = $('#city_id').val() || '';
            var type = $('#type').val() || '';
            if (region_id_1 && city_id == '') {
                $('#city_id').attr('required', ''); return;
            }
            window.location.href = '/article/article?is_show=' + is_show + '&region_id_id=' + region_id_1 + '&city_id=' + city_id + '&type=' + type;
        })
    })();



    function del(ids) {
        if (ids == 0) {
            ids = get_select_all();
        }
//        if (ids == '') {
//            layer.msg('请选择要操作的资讯', {icon: 5});
//            return false;
//        }
        $.post('/sysconf/rotation/delete', {ids: ids}, function (data) {
            if (data.code == 1) {
                layer.msg(data.msg, {
                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                }, function () {
                    window.parent.location.reload();
                });
            } else {
                layer.msg(data.msg);
            }
        }, 'json')
    }

    $(function () {
        {notempty name='Request.get.region_id_1'}
        get_type("city_id", '{$Request.get.region_id_1}', 0, '{$Request.get.city_id}');
        {/notempty}
     })
</script>