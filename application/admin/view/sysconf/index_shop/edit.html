<link rel="stylesheet" type="text/css" href="__CDN__/assets/libs/laydate/need/laydate.css?v={$site.version}"/>
<div class="panel panel-default panel-intro">
    <div class="panel-body">
        <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade active in" id="one">
                <div class="widget-body no-padding">
                    <div class="bootstrap-table">
                        <div class="fixed-table-toolbar">
                            <form id="edit-form" class="form-horizontal" role="form" data-toggle="validator" method="get" action="">
                                <div class="row"  style="margin:0;">
                                    <div style="float: left;width: 180px;margin-right: 5px;">
                                        <select class="form-control" name="region_id_3" id="region_id_3" onchange='javascript:get_type("region_id_4", this.value, 0,"","商圈")'>
                                            <option value="">区</option>
                                            <?php $type_list = array_combine(array_column($type_list, 'id'), $type_list);?>
                                            {volist name='region_list_3' id='vo'}
                                            <option value="{$key}" {if $Request.get.region_id_3 eq $key}selected{/if}>{$vo}</option>
                                            {/volist}
                                        </select>
                                    </div>
                                    <div style="float: left;width: 180px;margin-right: 5px;">
                                        <select class="form-control" name="region_id_4" id="region_id_4">
                                            <option value="">商圈</option>
                                        </select>
                                    </div>
                                    <div style="float: left;width: 180px;margin-right: 5px;">
                                        <select class="form-control" name="type_id" id="type_id">
                                            <option value="">分类</option>
                                            {volist name='type_list' id='vo'}
                                            <option value="{$vo.id}" <?php if(isset($_GET['type_id'])) echo $_GET['type_id']==$vo['id'] ? 'selected':'';?>>{$vo.name}</option>
                                            {/volist}
                                        </select>
                                    </div>
                                    <div style="float: left;width: 180px;margin-right: 5px;">
                                        <input class="form-control" name="name" type="text" value="{$Request.get.name ?? ''}" placeholder="门店名称">
                                    </div>
                                    <div style="float: left;width: 100px; background-color: #34c191;margin-bottom: 20px">
                                        <button type="submit" class="btn btn-success btn-ok btn-embossed" style="width: 100%;background-color: #34c191">搜 索</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="fixed-table-container" style="padding-bottom: 0px;">
                            <div class="fixed-table-header" style="display: none;">
                                <table></table>
                            </div>
                             {empty name='list'}
                            <p style="height: 400px; line-height: 400px; text-align: center; font-size: 21px;">未找到您要的门店o(╥﹏╥)o</p>
                            {else}
                            <div class="fixed-table-body">
                                <table id="table" class="table table-striped table-bordered table-hover" data-operate-edit="1" data-operate-del="1" width="100%">
                                    <thead>
                                    <tr>
                                        <th style="text-align: center; vertical-align: middle; " data-field="id">
                                            <div class="th-inner ">Id</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th style="text-align: center; vertical-align: middle; " data-field="name">
                                            <div class="th-inner ">区</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th style="text-align: center; vertical-align: middle; " data-field="nickname">
                                            <div class="th-inner ">商圈</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th style="text-align: center; vertical-align: middle; " data-field="nickname">
                                            <div class="th-inner ">分类</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th style="text-align: center; vertical-align: middle; " data-field="nickname">
                                            <div class="th-inner ">门店名称</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th style="text-align: center; vertical-align: middle; " data-field="operate">
                                            <div class="th-inner ">操作</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody data-listidx="0">
                                    {volist name='list' id='vo'}
                                    <tr>
                                        <td style="text-align: center; vertical-align: middle; ">{$vo.id ?? ''}</td>
                                        <td style="text-align: center; vertical-align: middle; ">
                                            {$vo.region3.0.name ?? ''}
                                        </td>
                                        <td style="text-align: center; vertical-align: middle; ">
                                            {$vo.region4.0.name ?? ''}
                                        </td>
                                        <td style="text-align: center; vertical-align: middle; "><?php $str = ''; foreach($vo['shop_type_shop'] as $value) if(isset($type_list[$value['type_id']])) $str .= $type_list[$value['type_id']]['name'] . ',';echo trim($str, ',');?></td>
                                        <td style="text-align: center; vertical-align: middle; ">{$vo.name ?? ''}</td>
                                        <td style="text-align: center; vertical-align: middle;  width: 120px;">
                                            <a href="javascript:;" class="ac-btn-check os-checkbox ac-check-{$vo.id}" title="选择" data-id="{$vo.id}"></a>
                                        </td>
                                    </tr>
                                    {/volist}
                                    </tbody>
                                    <div class="fixed-table-footer" style="display: none;">
                                        <table>
                                            <tbody>
                                            <tr></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="fixed-table-pagination">{$list->render()|raw}</div>
                                </table>
                            </div>

                            <div style="width: 100px; height: 36px; background-color:#34c191; margin: 0 auto; margin-top: 17px;">
                                <button type="submit" class="btn btn-grey btn-ok btn-embossed ac-btn-id" style="width: 100%; background-color:#34c191;height: 100%">保存</button>
                            </div>
                             {/empty}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    (function () {
          {notempty name = 'Request.get.region_id_3' }
        get_type("region_id_4", '{$Request.get.region_id_3}', 0, '{$Request.get.region_id_4}');
        {/notempty}
        $("#region_id_3").on("change", function () {
            $("#type_id").children(":first-child").prop('selected', true);
            $("#shop_id").children(":first-child").prop('selected', true);
        });
        $("#type_id").on("change", function () {
            $("#shop_id").children(":first-child").prop('selected', true);
        });

        var parent__element = parent.$("#good_add_database");
        var data = parent__element.attr("data-database");
        if(data==""||typeof data=="undefined") {
            data = ",";
        }else{
            var data_split = data.substring(1, data.length-1);
            $.each(data_split.split(","), function (index,val) {
                $(".ac-check-"+val).addClass("os-checkbox-focus")
            });
        }
        $(".ac-btn-check").on("click", function () {
            var data_id = $(this).attr("data-id");
            var data_Symbol = data_id + ",";
            if (data.indexOf("," + data_Symbol) != -1) {
                $(this).removeClass("os-checkbox-focus");
                data = data.replace(data_Symbol, "");
            } else {
                data = data + data_Symbol;
                $(this).addClass("os-checkbox-focus");
            }
            parent__element.attr("data-database", data);
        });

        $(".ac-btn-id").on("click",function() {
            if(data==",") {
                layer.msg('请选择门店后在提交');
            }else{
                $.ajax({
                            url: '/sysconf/index_shop/add',
                            type: 'POST',
                            data: {
                                shop_ids: data.substring(1, data.length-1)
                            },
                            async:false,
                            success: function (data) {
                                if(data.code==1) {
                                    layer.msg("您选择的门店提交成功，1秒后刷新");
                                    setTimeout(function () {
                                        window.parent.location.reload();
                                    },800);
                                }else{
                                    layer.msg(data.msg);
                                }
                            },
                            error:function(d) {
                                layer.msg("服务器忙，请稍候再试" );

                            }
                        }
                )
            }
        })
    })();
</script>