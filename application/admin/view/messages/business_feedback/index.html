<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>商家反馈</title>
		<script type="text/javascript" src="__CDN__/assets/libs/laydate5/laydate.js"></script>
		<script src="__CDN__/assets/js/vue.min.js"></script>
	</head>
	<style>
		.form-control {
			margin-right: 10px;
			padding: 6px 15px!important;
		}
		
		.fixed-table-toolbar {
			position: relative;
			padding-right: 110px;
		}
		
		.num {
			width: 100px;
			position: absolute;
			top: 0px;
			right: 10px;
		}
		
		.num .num_list {
			width: 100px;
		}
		
		table {
			font-size: 12px;
		}
		
		.editCC,
		.deleteCC {
			padding: 0 10px;
			margin: 0 10px;
			display: inline-block;
			line-height: 30px;
		}
		p{
			margin:5px 0!important;
		}
	</style>

	<body>

		<div class="panel panel-default panel-intro">
			<div class="panel-heading row" style="padding-top:0;color: #999;font-size: 12px; line-height: 50px; background-color: transparent">
				<!-- <div class="panel-lead"><em>门店分类管理</em></div> -->
				<div style="background-color: #e8edf0;width: 100%; height: 50px;padding-left: 15px">
					<div class="lf">
						<i class="fa fa-home" style="font-size: 14px;"></i>
					</div>
					<div class="panel-lead lf" style="margin: 0px;">消息中心&nbsp;&nbsp;&nbsp;> </div>
					<div class="panel-lead lf pl" style="margin: 0px;color: #34c191;">&nbsp;&nbsp;&nbsp;商家反馈</div>
				</div>
			</div>
			<div class="panel-body">
				<div id="myTabContent" class="tab-content">
					<div class="tab-pane fade active in" id="one">
						<div class="widget-body no-padding">
							<div class="bootstrap-table">
								<div class="fixed-table-toolbar">
									<div class="bs-bars">
										<div id="toolbar" class="toolbar" style="position: relative;">
											<form id="search_form" class="form-inline" role="form" data-toggle="validator" method="get" action="">
												<div class="row" style="margin:0;">
													<div style="float: left;width: 150px;margin-right: 10px;">
														<input class="form-control title-input" name="keyword" value="{$Think.get.keyword ?? ''}" style="width: 150px;" type="text" placeholder="关键词搜索">
													</div>
													<div style="float: left;width: 150px;margin-right: 10px;">
														<select class="form-control title-input" style="width: 150px;" name="device">
															<option value="">全部来源</option>
															{volist name='device' id='vo'}
															<option value="{$key}" {if $key eq $Think.get.device}selected{/if}>{$vo}</option>
															{/volist}
														</select>
													</div>

													<div style="float: left;width: 330px;margin-right: 10px;width: 180px;" class="shop-t">
														<input class="input-text laydate-icon os-pl-10" style="width: 180px; height: 36px;padding-left: 8px;font-size: 12px;border:1px solid #d2d6de" type="text" id="fromTime" name="from_time" placeholder="搜索时间区间" onfocus="this.blur()" />
													</div>
													<div style="float: left;width: 100px;margin-right: 25px; height: 36px;" class="shop-s">
														<button type="submit" class="btn btn-success btn-ok btn-embossed br" style="width: 100%;height: 36px; border-radius: 4px;background-color: #34c191;">搜索</button>
													</div>
												</div>
											</form>

										</div>
									</div>
									<div class="num">
										<select class="pull-left form-control title-input num_list" name="" id="">
											<option value="0">查看条数</option>
											{volist name='page_list' id='vo'}
											<option value="{$vo}" {if $Think.session.cur_limit eq $vo}selected{/if}>{$vo}</option>
											{/volist}
										</select>
									</div>
								</div>
								<div style="float: right;font-size: 12px;padding: 10px; margin: 0">共计
									<span style="color: #34c191;">{$list->total()}</span> 条反馈
								</div>
								<div id="show_data" class="fixed-table-container" style="padding-bottom: 0px;">
									<div class="fixed-table-header" style="display: none;">
										<table></table>
									</div>
									<div class="fixed-table-body">
										<table id="table" class="table table-striped table-bordered table-hover" width="100%">
											<thead>
												<tr style="background-color:#e8f7f2">
													<th class="bs-checkbox " style="text-align: center; vertical-align: middle; width: 60px; ">
														<div class="th-inner ">编号</div>
														<div class="fht-cell"></div>
													</th>
													<th class="bs-checkbox " style="text-align: center; vertical-align: middle;">
														<div class="th-inner ">反馈类型</div>
														<div class="fht-cell"></div>
													</th>
													<th style="text-align: center; vertical-align: middle; ">
														<div class="th-inner ">商户名称</div>
														<div class="fht-cell"></div>
													</th>
													<th style="text-align: center; vertical-align: middle; ">
														<div class="th-inner ">联系电话</div>
														<div class="fht-cell"></div>
													</th>
													<th style="text-align: center; vertical-align: middle; ">
														<div class="th-inner ">反馈时间</div>
														<div class="fht-cell"></div>
													</th>
													<th style="text-align: center; vertical-align: middle; ">
														<div class="th-inner ">来源</div>
														<div class="fht-cell"></div>
													</th>
													<th style="text-align: center; vertical-align: middle; " data-field="operate">
														<div class="th-inner ">操作</div>
													</th>
												</tr>
											</thead>
											<tbody>
												{volist name='list' id='vo'}
												<tr class="ac-tr" data-id="{$vo.id}">
													<th class="bs-checkbox " style="text-align: center; vertical-align: middle; width: 60px;">
														{$vo.id}
													</th>
													<th style="text-align:center;vertical-align: middle;">
														<!--评价问题、异常反馈、产品建议、其它问题-->
														{volist name='vo.types' id='vo2'}
														<p>{$feedback_type[$vo2] ?? ''}</p>
														{/volist}
													</th>
													<th style="text-align:center; vertical-align: middle;">
														{$vo.nickname ?? ''}
													</th>
													<th class="ac-store-name-tr" style="text-align: center; vertical-align: middle;">
														{if $is_super}
														{$vo.mobile}
														{else}
														{$vo.mobile ? substr_replace($vo.mobile, '****', 3, 4) : ''}
														{/if}
													</th>
													<th style="text-align: center; vertical-align: middle;">
														{$vo.create_time}
													</th>
													<th style="text-align: center; vertical-align: middle;">
														{$device[$vo.device] ?? ''}
													</th>
													<th style="text-align: center; vertical-align: middle;">
														<a class="btn-editone btn-color editCC" title="查看" onclick="layer_open('商户反馈详情', '/messages/business_feedback/feedback_content?ids={$vo.id}',{w:'800px',h:'600px'});" href="javascript:void(0)">
															<i class="iconfont icon-chakan"></i>
														</a>
														<a href="javascript:void(0)" class="deleteCC" style="color: red;" title="删除" data-id="{$vo.id}">
															<i class="iconfont icon-shanchu"></i>
														</a>
													</th>
												</tr>
												{/volist}
											</tbody>
										</table>

									</div>
									<div class="fixed-table-footer" style="display: none;">
										<table>
											<tbody>
												<tr></tr>
											</tbody>
										</table>
									</div>
									<div class="fixed-table-pagination">{$list->render()|raw}</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
<script type="text/javascript">
	$(function(){		
	      //改变显示条数
		  $('.num_list').change(function(){
		  	var value=$(this).find('option:selected').val();
		  	var keyword=$('input[name="keyword"]').val();		  	
		  	var device=$('select[name="device"]').find('option:selected').val();
		  	var from_time=$('input[name="from_time"]').val();		  	
		  	location.href = location.href ='/messages/business_feedback/index?cur_limit=' + value+'&keyword='+keyword+'&from_time='+from_time+'&device='+device;   
		  }) 
		  
		  // 删除数据
	    $('.deleteCC').on("click",function () {
	        var formData = {},htmlInstance = $(this);
	        formData.ids = $(this).attr('data-id');
	        var url = '/messages/business_feedback/delete';
	        //询问框
	        layer.confirm('您确定要删除该数据？', {
	            btn: ['确定','取消'] //按钮
	        }, function(){
	            $.ajax({
	                type: 'POST',
	                url: url,
	                data: formData,
	                success: function (result) {
	                    //提示层
	                    layer.msg(result.msg);
	                    if (result.code == 1){
	                        window.location.reload();
	                    }
	                },
	                error: function(msg){
	                    //提示层
	                    layer.msg('服务器忙，请稍后··');
	                },
	                dataType: 'JSON'
	            });
	        });
	    });
		  
	})
	/**
     * 加载时间插件
     */
    laydate.render({
        elem: '#fromTime'
        ,range: true
        ,value: "{$Request.get.from_time ?? ''}"
    });

    $(function () {
        {notempty name='Request.get.region_id_3'}
        get_type("region_id_4", '{$Request.get.region_id_3}', 0, '{$Request.get.region_id_4}');
        {/notempty}
    })
	

</script>