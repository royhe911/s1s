<!-- <link rel="stylesheet" type="text/css" href="__CDN__/assets/less/artical/index.css"/> -->
<link rel="stylesheet" type="text/css" href="__CDN__/assets/css/common.css"/>
<style>
    .fixed-table-toolbar #edit-form{
        float: left;
    }
    .fixed-table-toolbar .row{
        float: right;
    }
    .fixed-table-toolbar .bs-bars {
        margin: 0;
    }
    .fixed-table-toolbar .bs-bars a{
        width: 100px;
        line-height: 36px;
        text-align: center;
        background-color: #37c6c0;
        padding: 0;
        border-radius: 4px;
    }
    .fixed-table-toolbar{
        /* margin: 5px 0 20px 0; */
    }
</style>
<script type="text/javascript" src="__CDN__/assets/libs/laydate5/laydate.js"></script>
<div class="panel panel-default panel-intro">
    <!-- <div class="panel-heading row" style="padding-top:0;padding-left: 30px;color: #999;font-size: 12px;">
        <div class="lf"><i class="fa fa-home" style="font-size: 14px;"></i></div>
        <div class="panel-lead lf" style="margin-left: 7px;">资讯管理 ></div>
        <div class="panel-lead lf" style="margin-left: 7px; color:#34c191 "> 资讯列表</div>
    </div> -->
    <div class="panel-heading row" style="padding-top:0;color: #999;font-size: 12px; line-height: 50px; background-color: transparent">
        <div style="background-color: #e8edf0;width: 100%; height: 50px;padding-left: 15px">
            <div class="lf">
                <i class="fa fa-home" style="font-size: 14px;"></i>
            </div>
            <div class="panel-lead lf" style="margin: 0px;">资讯管理&nbsp;&nbsp;&nbsp;> </div>
            <div class="panel-lead lf pl" style="margin: 0px;color: #34c191;">&nbsp;&nbsp;&nbsp;帮助文档列表</div>
        </div>
    </div>
    <div class="panel-body">
        <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade active in" id="one">
                <div class="widget-body no-padding">
                    <div class="bootstrap-table">
                        <div class="fixed-table-toolbar">
                           <div class="clearfix">
                                <form id="edit-form" class="form-horizontal" role="form" data-toggle="validator" method="get" action="">
                                    <div class="row" style="margin:0;">
                                        <div style="float: left;width: 150px; height: 36px; margin-right: 10px;">
                                            <select class="form-control title-input"  name="type_id" id='alltype'>
                                                <option value="">全部分类</option>
                                                {volist name='type_list' id='vo'}
                                                <option value="{$vo.id}" {if $Request.get.type_id eq $vo.id}selected{/if}>{$vo.name}</option>
                                                {/volist}
                                            </select>
                                        </div>

                                        <div style="float: left;width: 330px;margin-right: 5px;width: 180px;">
                                            <input class="input-text laydate-icon os-pl-10" style="width: 180px; height: 36px;padding-left: 8px;font-size: 12px;border:1px solid #d2d6de" type="text" id="fromTime" name="from_time" placeholder="搜索时间区间" onfocus="this.blur()"/>
                                        </div>
                                        <div style="float: left;width: 100px;">
                                            <button id="submit" class="btn btn-success btn-ok btn-embossed br" style="width: 100%; height: 36px; background-color: #34c191">搜 索</button>
                                        </div>
                                    </div>
                                </form>
                                <div class="row" style="margin:0;">
                                    <div class="bs-bars pull-left">
                                        <div id="toolbar" class="toolbar" style="position: relative;">
                                            <a href="/article/help/add" class="btn btn-success btn-add bs-bars-com" title="添加帮助文档" style="background-color: #34c191;">添加帮助文档</a>
                                        </div>
                                    </div>
                                    <div class="num pull-left" style="margin-left:10px;">
		                            	<select class="pull-left form-control title-input num_list" style="width:110px;border-color:#34C191;">
		                                	<option value="0">查看条数</option>
		                                	{volist name='page_list' id='vo'}
		                                	<option value="{$vo}" {if $Think.session.cur_limit eq $vo}selected{/if}>{$vo}</option>
		                                	{/volist}
		                                </select>
		                            </div>   
                                </div>
                           </div>
                            <p style="float: right;font-size: 12px;padding: 8px; margin: 0">共计
                                <span style="color: #34c191;">{$list->total()}</span> 个帮助文档</p>
                        </div>
                        <div class="fixed-table-container" style="padding-bottom: 0px;">
                            <div class="fixed-table-header" style="display: none;">
                                <table></table>
                            </div>
                            <div class="fixed-table-body">

                                <table id="table" class="table table-striped table-bordered table-hover" data-operate-edit="1" data-operate-del="1" width="100%">
                                    <thead>
                                    <tr style=" background-color:#e8f7f2; ">
                                        <th class="col-xs-1" style="text-align: center; vertical-align: middle;" data-field="">
                                            <div class="th-inner ">编号</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th class="col-xs-3" style="text-align: center; vertical-align: middle; " data-field="">
                                            <div class="th-inner ">帮助名称</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th class="col-xs-1" style="text-align: center; vertical-align: middle; " data-field="">
                                            <div class="th-inner ">分类</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th class="col-xs-2" style="text-align: center; vertical-align: middle; " data-field="">
                                            <div class="th-inner ">添加时间</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th class="col-xs-1" style="text-align: center; vertical-align: middle; " data-field="">
                                            <div class="th-inner ">状态</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th class="col-xs-1" style="text-align: center; vertical-align: middle; " data-field="">
                                            <!-- <div class="icon iconfont icon-tianjia1"></div> -->
                                            <div class="th-inner ">操作</div>
                                            <div class="fht-cell"></div>
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody data-listidx="0">
                                    {volist name='list' id='vo'}
                                    <tr>
                                        <td style="text-align: center; vertical-align: middle; ">{$vo.id}</td>
                                        <td class="ac-article-name" style="text-align: center; vertical-align: middle; " title="{$vo.title}">
                                            {$vo.title}
                                        </td>
                                        <td style="text-align: center; vertical-align: middle; ">{$vo.name}</td>
                                        <td style="text-align: center; vertical-align: middle; ">{$vo.create_time}</td>
                                        <td style="text-align: center; vertical-align: middle; ">
                                            {if $vo.is_show eq 1}
                                            <a class="btn-change text-success ac-is-stop" href="javascript:;" data-isStop="0" data-id="{$vo.id}" title="隐藏">
                                                <i class="fa fa-toggle-on fa-2x" style="color: #18bc9c;"></i>
                                            </a>
                                            {else}
                                            <a class="btn-change text-success ac-is-stop" href="javascript:;" data-isStop="1" data-id="{$vo.id}" title="显示">
                                                <i class="fa fa-toggle-off fa-2x" style="color: #18bc9c;"></i>
                                            </a>
                                            {/if}
                                        </td>
                                        <td style="text-align: center; vertical-align: middle; ">
                                            <!-- <a href="" style="color: #9f9f9f; margin-right:5px; display: inline-block" class="albumCC" title="编辑" data-table-id="table" data-field-index="9" data-row-index="0" data-button-index="0"><i class="iconfont icon-edit"></i></a> -->
                                            <a href="javascript:;" data-url="/article/help/edit/ids/{$vo.id}" class="{if $vo.is_show eq 1}editClick{else}btn-s{/if} btn-editone btn-color editCC" title="编辑"
                                                data-table-id="table" data-field-index="9" data-row-index="0" data-button-index="0">
                                                <i class="iconfont icon-edit"></i>
                                            </a>
                                            <a href="javascript:;" onclick="del({$vo.id});" style="color: #9f9f9f; margin-right:5px; display: inline-block;margin-left: 5px;" class="deleteCC" title="删除" data-table-id="table" data-field-index="9" data-row-index="30" data-button-index="2"><i class="iconfont icon-shanchu"></i></a>                                           
                                        </td>
                                    </tr>
                                    {/volist}
                                    </tbody>
                                </table>
                            </div>
                            <div class="fixed-table-footer" style="display: none;">
                                <table>
                                    <tbody>
                                    <tr></tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="fixed-table-pagination">{$list->render()|raw}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
	
    (function () {
    	//切换条数
    	$('.num_list').change(function(){
        	var value=$(this).find('option:selected').val();
        	var type_id=$('select[name="type_id"]').find('option:selected').val();
        	var from_time=$('input[name="from_time"]').val();
        	location.href = '/article/help/index?cur_limit=' + value+'&type_id='+type_id+'&from_time='+from_time;
        })
    	
        function modify_width(bool) {
            $.each(article,function(index,val) {
                var width = $(val).width();
                if(bool) {
                    var title= $(val).attr("title");
                    $(val).attr("title", "");
                    $(val).children().html(title).width(width);
                }else{
                    $(val).children().width(width);
                }
            })
        }
        var article = $(".ac-article-name");
        modify_width(true);
        window.onresize=function() {
            modify_width();
        };
        var prevent_more_click = true;
        $(".ac-is-stop").on("click", function () {
            if(prevent_more_click) {
                var obj = {
                    url: '/article/help/edit_status',
                    info_msg: '请选择要操作的帮助文档',
                    show_stop:"隐藏",
                    show_start:"显示"
                };
                obj.os_this = $(this);
                obj.is_stop = $(this).attr("data-isStop");
                obj.id = $(this).attr("data-id");
                is_stop(obj);
                prevent_more_click = false;
                setTimeout(function () {
                    prevent_more_click = true;
                }, 600);
                if (obj.is_stop == 1) {
                    $(this).parent().next().children('.btn-editone').removeClass('btn-s').addClass('editClick')
                } else {
                    $(this).parent().next().children('.btn-editone').removeClass('editClick').addClass('btn-s')
                    // $('this').css('backgroundColor', '#34c191')
                }
            }
        });
        $(document).on('click', '.btn-s', function () {
            var url = $(this).attr('data-url');
            window.location.href = url;
            // layer_open('编辑', url, { w: '580px', h: '700px' })
        })
        //提交
        $('#submit').on('click', function () {
            var type_id = $('#alltype').val() || '';
            var from_time = $('#fromTime').val() || '';
            window.location.href = '/article/help?type_id=' + type_id + '&from_time=' + from_time;
        })
        
    })();


    function del(ids) {

        if (ids == 0) {
            ids = get_select_all();
        }
//        if (ids == '') {
//            layer.alert('请选择要操作的资讯', {icon: 5});
//            return false;
//        }
        layer.confirm('确认删除帮助文档吗？', {icon: 3, title:'提示'}, function(){
            $.post('/article/help/delete', {ids: ids}, function (data) {
                if (data.code == 1) {
                    layer.msg(data.msg, {
                        time: 2000 //2秒关闭（如果不配置，默认是3秒）
                    }, function () {
                        window.parent.location.reload();
                    });
                } else {
                    layer.alert(data.msg, {icon: 5});
                }
            }, 'json')
        });
    }
    /**
     * 加载时间插件
     */
    laydate.render({
        elem: '#fromTime'
        ,range: true
        ,value: "{$Request.get.from_time ?? ''}"
    });
</script>